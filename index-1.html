<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Swing Scanner Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#040608;overflow:hidden}
    ::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#111820;border-radius:3px}
    input::placeholder{color:#1e3050}select option{background:#080b0e}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
    @keyframes pulse{0%,100%{opacity:0.4}50%{opacity:1}}
    @keyframes fadeIn{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
  </style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useCallback,useRef,useMemo}=React;
const BASE="https://api.binance.com/api/v3";

// ‚îÄ‚îÄ‚îÄ SIGNAL COLORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SC={
  "PRIME":  {bg:"#04160b",border:"#00ff88",text:"#00ff88",glow:"#00ff8840"},
  "STRONG": {bg:"#061612",border:"#22c55e",text:"#22c55e",glow:"#22c55e30"},
  "WATCH":  {bg:"#141000",border:"#eab308",text:"#eab308",glow:"#eab30820"},
  "AVOID":  {bg:"#140404",border:"#ef4444",text:"#ef4444",glow:"#ef444420"},
};

// ‚îÄ‚îÄ‚îÄ TECHNICAL INDICATORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcEMA(prices, period) {
  if (!prices || prices.length < period) return null;
  const k = 2 / (period + 1);
  let ema = prices.slice(0, period).reduce((a, b) => a + b, 0) / period;
  for (let i = period; i < prices.length; i++) ema = prices[i] * k + ema * (1 - k);
  return ema;
}

function calcEMASeries(prices, period) {
  if (!prices || prices.length < period) return [];
  const k = 2 / (period + 1);
  let ema = prices.slice(0, period).reduce((a, b) => a + b, 0) / period;
  const series = new Array(period - 1).fill(null);
  series.push(ema);
  for (let i = period; i < prices.length; i++) { ema = prices[i] * k + ema * (1 - k); series.push(ema); }
  return series;
}

function calcRSI(prices, period = 14) {
  if (!prices || prices.length < period + 1) return 50;
  let gains = 0, losses = 0;
  for (let i = prices.length - period; i < prices.length; i++) {
    const d = prices[i] - prices[i - 1];
    if (d > 0) gains += d; else losses -= d;
  }
  let ag = gains / period, al = losses / period;
  // Smooth with remaining bars
  for (let i = prices.length - period + 1; i < prices.length; i++) {
    const d = prices[i] - prices[i - 1];
    ag = (ag * (period - 1) + Math.max(d, 0)) / period;
    al = (al * (period - 1) + Math.max(-d, 0)) / period;
  }
  return al === 0 ? 100 : 100 - 100 / (1 + ag / al);
}

function calcMACD(prices) {
  if (!prices || prices.length < 26) return { macd: 0, signal: 0, hist: 0, crossover: false };
  const ema12 = calcEMASeries(prices, 12);
  const ema26 = calcEMASeries(prices, 26);
  const macdLine = ema12.map((v, i) => (v && ema26[i]) ? v - ema26[i] : null).filter(Boolean);
  if (macdLine.length < 9) return { macd: 0, signal: 0, hist: 0, crossover: false };
  const signalLine = calcEMASeries(macdLine, 9);
  const last = macdLine.length - 1;
  const macd = macdLine[last];
  const sig = signalLine[last];
  const prevMacd = macdLine[last - 1];
  const prevSig = signalLine[last - 1];
  const hist = macd - sig;
  // Bullish crossover: MACD just crossed above signal
  const crossover = prevMacd < prevSig && macd > sig;
  // Recent bullish cross (within last 3 bars)
  const recentCross = macdLine.slice(-3).some((m, i) => {
    const s = signalLine.slice(-3)[i];
    const pm = macdLine.slice(-4)[i];
    const ps = signalLine.slice(-4)[i];
    return pm && ps && pm < ps && m > s;
  });
  return { macd, signal: sig, hist, crossover, recentCross, bullish: macd > sig };
}

function calcBollingerBands(prices, period = 20, stdDev = 2) {
  if (!prices || prices.length < period) return { upper: 0, mid: 0, lower: 0, pct: 0.5 };
  const slice = prices.slice(-period);
  const mid = slice.reduce((a, b) => a + b, 0) / period;
  const variance = slice.reduce((a, b) => a + Math.pow(b - mid, 2), 0) / period;
  const std = Math.sqrt(variance);
  const upper = mid + stdDev * std;
  const lower = mid - stdDev * std;
  const price = prices[prices.length - 1];
  const pct = std === 0 ? 0.5 : (price - lower) / (upper - lower); // 0=at lower, 1=at upper
  return { upper, mid, lower, pct };
}

function detectCandlePattern(klines) {
  // klines: array of {o, h, l, c} objects
  if (!klines || klines.length < 3) return { pattern: "None", bullish: false, strength: 0 };
  const last = klines[klines.length - 1];
  const prev = klines[klines.length - 2];
  const prev2 = klines[klines.length - 3];
  const { o, h, l, c } = last;
  const body = Math.abs(c - o);
  const totalRange = h - l || 0.0001;
  const upperWick = h - Math.max(o, c);
  const lowerWick = Math.min(o, c) - l;

  // Hammer / Bullish Pin Bar: small body, long lower wick, near bottom
  if (lowerWick > body * 2 && lowerWick > upperWick * 2 && c > o)
    return { pattern: "Hammer", bullish: true, strength: 3 };

  // Bullish Engulfing: current green candle engulfs previous red
  if (c > o && prev.c < prev.o && c > prev.o && o < prev.c)
    return { pattern: "Bullish Engulfing", bullish: true, strength: 3 };

  // Morning Star: 3-candle reversal
  if (prev2.c < prev2.o && Math.abs(prev.c - prev.o) < totalRange * 0.3 && c > o && c > (prev2.o + prev2.c) / 2)
    return { pattern: "Morning Star", bullish: true, strength: 3 };

  // Bullish Harami: small green inside previous big red
  if (c > o && prev.c < prev.o && c < prev.o && o > prev.c && body < Math.abs(prev.c - prev.o) * 0.6)
    return { pattern: "Bullish Harami", bullish: true, strength: 2 };

  // Doji near support (indecision, potential reversal)
  if (body < totalRange * 0.1 && lowerWick > totalRange * 0.3)
    return { pattern: "Doji (Reversal?)", bullish: true, strength: 1 };

  // Inverted Hammer at bottom
  if (upperWick > body * 2 && lowerWick < body * 0.5 && c > o)
    return { pattern: "Inv. Hammer", bullish: true, strength: 1 };

  // Bearish patterns
  if (upperWick > body * 2 && c < o) return { pattern: "Shooting Star", bullish: false, strength: -2 };
  if (c < o && prev.c > prev.o && c < prev.o && o > prev.c) return { pattern: "Bearish Engulfing", bullish: false, strength: -3 };

  // Plain bullish or bearish candle
  if (c > o && body > totalRange * 0.6) return { pattern: "Strong Bullish", bullish: true, strength: 2 };
  if (c < o && body > totalRange * 0.6) return { pattern: "Strong Bearish", bullish: false, strength: -1 };

  return { pattern: "Neutral", bullish: false, strength: 0 };
}

function detectRSIDivergence(closes, period = 14) {
  if (closes.length < 30) return { bullishDiv: false, bearishDiv: false };
  // Check last 15 bars for divergence
  const rsiSeries = [];
  for (let i = period + 1; i <= closes.length; i++) rsiSeries.push(calcRSI(closes.slice(0, i)));
  const priceLast = closes[closes.length - 1];
  const pricePrev = Math.min(...closes.slice(-15, -5));
  const rsiLast = rsiSeries[rsiSeries.length - 1];
  const rsiPrev = Math.min(...rsiSeries.slice(-15, -5));
  // Bullish divergence: price made lower low but RSI made higher low
  const bullishDiv = priceLast < pricePrev && rsiLast > rsiPrev + 2;
  // Bearish divergence: price higher high but RSI lower high
  const priceHigh = closes[closes.length - 1] > Math.max(...closes.slice(-15, -5));
  const rsiHigh = rsiLast < Math.max(...rsiSeries.slice(-15, -5)) - 2;
  const bearishDiv = priceHigh && rsiHigh;
  return { bullishDiv, bearishDiv };
}

function calcSupportResistance(highs, lows, closes) {
  if (!closes || closes.length < 10) return { support: 0, resistance: 0, nearSupport: false, nearResistance: false };
  const price = closes[closes.length - 1];
  // Use recent pivot lows/highs (last 20 bars)
  const recentLows = lows.slice(-20);
  const recentHighs = highs.slice(-20);
  const support = Math.min(...recentLows);
  const resistance = Math.max(...recentHighs);
  const range = resistance - support;
  const pct = range > 0 ? (price - support) / range : 0.5;
  // Near support = bottom 25% of range ‚Üí good entry zone
  const nearSupport = pct < 0.28;
  // Near resistance = top 20% ‚Üí don't buy here
  const nearResistance = pct > 0.80;
  return { support, resistance, pct, nearSupport, nearResistance };
}

function isOverextended(closes, ema20) {
  if (!ema20 || !closes.length) return false;
  const price = closes[closes.length - 1];
  // Price more than 8% above EMA20 = overextended, risky entry
  return price > ema20 * 1.08;
}

// ‚îÄ‚îÄ‚îÄ MAIN SCORING ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function scoreOpportunity({ closes, highs, lows, opens, volume, avgVolume }) {
  const price = closes[closes.length - 1];
  const klines = closes.map((c, i) => ({ o: opens[i], h: highs[i], l: lows[i], c }));

  const rsi = calcRSI(closes);
  const ema20 = calcEMA(closes, 20);
  const ema50 = calcEMA(closes, 50);
  const macd = calcMACD(closes);
  const bb = calcBollingerBands(closes);
  const candle = detectCandlePattern(klines);
  const div = detectRSIDivergence(closes);
  const sr = calcSupportResistance(highs, lows, closes);
  const volSpike = avgVolume > 0 ? volume / avgVolume : 1;
  const overextended = isOverextended(closes, ema20);

  // EMA trend alignment
  const emaTrendBull = ema20 && ema50 && ema20 > ema50;
  const priceAboveEma20 = ema20 && price > ema20;

  // Score breakdown ‚Äî each factor is explicit
  const factors = {};

  // 1. RSI ‚Äî want oversold recovery (35‚Äì50), not overbought
  if (rsi < 30)        factors.rsi = { score: 18, label: `RSI ${rsi.toFixed(0)} ‚Äî Oversold`, good: true };
  else if (rsi < 40)   factors.rsi = { score: 22, label: `RSI ${rsi.toFixed(0)} ‚Äî Recovery zone`, good: true };
  else if (rsi < 50)   factors.rsi = { score: 15, label: `RSI ${rsi.toFixed(0)} ‚Äî Neutral`, good: true };
  else if (rsi < 60)   factors.rsi = { score: 8,  label: `RSI ${rsi.toFixed(0)} ‚Äî Elevated`, good: false };
  else if (rsi < 70)   factors.rsi = { score: 3,  label: `RSI ${rsi.toFixed(0)} ‚Äî High`, good: false };
  else                 factors.rsi = { score: -5, label: `RSI ${rsi.toFixed(0)} ‚Äî Overbought`, good: false };

  // 2. MACD
  if (macd.crossover)        factors.macd = { score: 20, label: "MACD Bullish Crossover ‚ú¶", good: true };
  else if (macd.recentCross) factors.macd = { score: 15, label: "MACD Recent Cross", good: true };
  else if (macd.bullish)     factors.macd = { score: 8,  label: "MACD Bullish", good: true };
  else if (macd.hist > 0)    factors.macd = { score: 4,  label: "MACD Hist Positive", good: true };
  else                       factors.macd = { score: -3, label: "MACD Bearish", good: false };

  // 3. Volume spike (min $50M enforced before this point, spike vs avg)
  if (volSpike > 3.0)      factors.volume = { score: 20, label: `Vol √ó${volSpike.toFixed(1)} ‚Äî Huge spike`, good: true };
  else if (volSpike > 2.0) factors.volume = { score: 15, label: `Vol √ó${volSpike.toFixed(1)} ‚Äî Strong spike`, good: true };
  else if (volSpike > 1.4) factors.volume = { score: 9,  label: `Vol √ó${volSpike.toFixed(1)} ‚Äî Elevated`, good: true };
  else if (volSpike > 0.8) factors.volume = { score: 4,  label: `Vol √ó${volSpike.toFixed(1)} ‚Äî Normal`, good: false };
  else                     factors.volume = { score: 0,  label: `Vol √ó${volSpike.toFixed(1)} ‚Äî Low`, good: false };

  // 4. Candle pattern
  if (candle.strength >= 3)      factors.candle = { score: 18, label: `${candle.pattern} ‚ú¶`, good: true };
  else if (candle.strength === 2) factors.candle = { score: 12, label: candle.pattern, good: true };
  else if (candle.strength === 1) factors.candle = { score: 6,  label: candle.pattern, good: true };
  else if (candle.strength === 0) factors.candle = { score: 2,  label: candle.pattern, good: false };
  else                            factors.candle = { score: -5, label: `${candle.pattern} ‚ö†`, good: false };

  // 5. Bollinger Band position
  if (bb.pct < 0.1)        factors.bb = { score: 14, label: "At Lower BB ‚Äî Mean reversion setup", good: true };
  else if (bb.pct < 0.25)  factors.bb = { score: 10, label: "Near Lower BB", good: true };
  else if (bb.pct < 0.5)   factors.bb = { score: 5,  label: "Mid-BB range", good: true };
  else if (bb.pct < 0.75)  factors.bb = { score: 1,  label: "Upper BB half", good: false };
  else                     factors.bb = { score: -4, label: "Near Upper BB ‚Äî Risky entry", good: false };

  // 6. Support/Resistance position
  if (sr.nearSupport)          factors.sr = { score: 14, label: "Near Key Support ‚ú¶", good: true };
  else if (sr.pct < 0.45)      factors.sr = { score: 7,  label: "Below Midrange", good: true };
  else if (sr.nearResistance)  factors.sr = { score: -8, label: "Near Resistance ‚Äî Don't buy!", good: false };
  else                         factors.sr = { score: 2,  label: "Mid range", good: false };

  // 7. Trend (EMA alignment)
  if (emaTrendBull && priceAboveEma20)    factors.trend = { score: 10, label: "Uptrend ‚Äî EMA20 > EMA50", good: true };
  else if (emaTrendBull)                  factors.trend = { score: 6,  label: "Trend bullish, price dip", good: true };
  else if (!emaTrendBull && !priceAboveEma20) factors.trend = { score: -5, label: "Downtrend ‚Äî counter-trend risk", good: false };
  else                                    factors.trend = { score: 2,  label: "Mixed trend", good: false };

  // 8. RSI Divergence (early signal)
  if (div.bullishDiv)   factors.divergence = { score: 12, label: "Bullish RSI Divergence ‚ú¶ Early signal!", good: true };
  else if (div.bearishDiv) factors.divergence = { score: -6, label: "Bearish RSI Divergence ‚ö†", good: false };
  else                  factors.divergence = { score: 0, label: "No divergence", good: false };

  // ‚îÄ‚îÄ Hard penalties ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (overextended) {
    factors.overextended = { score: -25, label: "‚ö† Overextended ‚Äî price >8% above EMA20", good: false };
  }
  if (sr.nearResistance && rsi > 65) {
    factors.topCandle = { score: -15, label: "‚ö† Possible top candle ‚Äî RSI high + near resistance", good: false };
  }

  const rawScore = Object.values(factors).reduce((s, f) => s + f.score, 0);
  // Normalize to 0‚Äì100
  const score = Math.max(0, Math.min(100, Math.round(rawScore + 45)));

  // Signal tier
  let signal;
  if (score >= 80)      signal = "PRIME";
  else if (score >= 63) signal = "STRONG";
  else if (score >= 45) signal = "WATCH";
  else                  signal = "AVOID";

  // R/R calculation based on actual support/resistance
  const entryPrice = price;
  const stopLoss = sr.support * 0.985 || price * 0.93;
  const target = sr.resistance * 0.99 || price * 1.18;
  const rrRatio = stopLoss < entryPrice ? ((target - entryPrice) / (entryPrice - stopLoss)).toFixed(1) : "‚Äî";

  return {
    rsi, ema20, ema50, macd, bb, candle, div, sr, volSpike, overextended,
    emaTrendBull, priceAboveEma20, factors, score, signal,
    target, stopLoss, rrRatio,
    support: sr.support, resistance: sr.resistance
  };
}

// ‚îÄ‚îÄ‚îÄ SIMULATED FALLBACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SIM_COINS=[
  {symbol:"BTC",price:67500,vol:2.8e9},{symbol:"ETH",price:3480,vol:1.4e9},
  {symbol:"BNB",price:598,vol:480e6},{symbol:"SOL",price:172,vol:640e6},
  {symbol:"XRP",price:0.54,vol:320e6},{symbol:"DOGE",price:0.162,vol:280e6},
  {symbol:"ADA",price:0.457,vol:220e6},{symbol:"AVAX",price:38.2,vol:310e6},
  {symbol:"LINK",price:14.8,vol:190e6},{symbol:"DOT",price:7.4,vol:155e6},
  {symbol:"UNI",price:8.9,vol:170e6},{symbol:"NEAR",price:7.1,vol:210e6},
  {symbol:"LTC",price:84,vol:440e6},{symbol:"MATIC",price:0.72,vol:280e6},
  {symbol:"APT",price:10.4,vol:195e6},{symbol:"ARB",price:1.12,vol:240e6},
  {symbol:"OP",price:2.4,vol:190e6},{symbol:"SUI",price:1.28,vol:290e6},
  {symbol:"INJ",price:27.4,vol:210e6},{symbol:"ATOM",price:8.8,vol:160e6},
  {symbol:"FET",price:2.31,vol:220e6},{symbol:"AAVE",price:98,vol:110e6},
  {symbol:"RNDR",price:8.4,vol:120e6},{symbol:"TIA",price:8.1,vol:130e6},
  {symbol:"RUNE",price:5.4,vol:98e6},{symbol:"STX",price:1.96,vol:120e6},
  {symbol:"IMX",price:2.14,vol:90e6},{symbol:"WLD",price:4.8,vol:140e6},
  {symbol:"BONK",price:0.0000298,vol:180e6},{symbol:"KAS",price:0.128,vol:62e6},
];

function makeSim(coin) {
  const n = 50;
  let p = coin.price;
  const trend = Math.random() > 0.5 ? 1 : -1;
  const closes=[],opens=[],highs=[],lows=[];
  for (let i=0;i<n;i++) {
    const o=p; p*=(1+(Math.random()-0.48)*0.025+trend*0.003);
    const h=Math.max(o,p)*(1+Math.random()*0.01);
    const l=Math.min(o,p)*(1-Math.random()*0.01);
    opens.push(o);closes.push(p);highs.push(h);lows.push(l);
  }
  const avgVol = coin.vol * (0.8+Math.random()*0.4);
  const volume = avgVol * (0.7+Math.random()*2.5);
  const change24h=(closes[n-1]-closes[n-2])/closes[n-2]*100;
  const change7d=(closes[n-1]-closes[Math.max(0,n-43)])/closes[Math.max(0,n-43)]*100;
  const analysis=scoreOpportunity({closes,highs,lows,opens,volume,avgVolume:avgVol});
  return {
    id:coin.symbol,symbol:coin.symbol,name:coin.symbol,
    price:closes[n-1],change24h,change7d,volume,
    closes,opens,highs,lows,...analysis,dataSource:"simulated"
  };
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtVol(n){if(n>=1e9)return"$"+(n/1e9).toFixed(2)+"B";if(n>=1e6)return"$"+(n/1e6).toFixed(1)+"M";return"$"+n.toFixed(0);}
function fmtPrice(n,sym){if(!n)return"‚Äî";if(sym==="BTC"||n>=10000)return"$"+Math.round(n).toLocaleString();if(n>=100)return"$"+n.toFixed(1);if(n>=1)return"$"+n.toFixed(2);if(n>=0.01)return"$"+n.toFixed(4);return"$"+n.toFixed(8);}
function pct(n){return(n>=0?"+":"")+n.toFixed(2)+"%";}

// ‚îÄ‚îÄ‚îÄ UI COMPONENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ScoreRing({score}){
  const c=score>=80?"#00ff88":score>=63?"#22c55e":score>=45?"#eab308":"#ef4444";
  const r=16,circ=2*Math.PI*r,dash=circ*(score/100);
  return(
    <svg width="42" height="42" style={{flexShrink:0}}>
      <circle cx="21" cy="21" r={r} fill="none" stroke="#111820" strokeWidth="3"/>
      <circle cx="21" cy="21" r={r} fill="none" stroke={c} strokeWidth="3"
        strokeDasharray={`${dash} ${circ-dash}`} strokeDashoffset={circ/4}
        strokeLinecap="round" style={{filter:`drop-shadow(0 0 4px ${c}88)`}}/>
      <text x="21" y="25" textAnchor="middle" fill={c} fontSize="10" fontFamily="'IBM Plex Mono',monospace" fontWeight="700">{score}</text>
    </svg>
  );
}

function MiniBar({label,value,max,color,danger}){
  const pctFill=Math.max(0,Math.min(100,(value/max)*100));
  return(
    <div style={{marginBottom:5}}>
      <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:"#3d5070",marginBottom:2}}>
        <span>{label}</span><span style={{color}}>{typeof value==="number"?value.toFixed(1):value}</span>
      </div>
      <div style={{height:3,background:"#111820",borderRadius:2}}>
        <div style={{height:3,width:`${pctFill}%`,background:danger&&pctFill>75?"#ef4444":color,borderRadius:2,transition:"width 0.6s ease"}}/>
      </div>
    </div>
  );
}

function Tag({label,good}){
  const c=good?"#22c55e":"#ef4444";
  return<span style={{background:c+"15",border:`1px solid ${c}40`,color:c,fontSize:9,padding:"1px 6px",borderRadius:3,fontFamily:"'IBM Plex Mono',monospace",whiteSpace:"nowrap"}}>{label}</span>;
}

function StatBox({label,value,color="#c8d4e8",sub}){
  return(
    <div style={{background:"#0b1018",border:"1px solid #1a2535",borderRadius:7,padding:"9px 11px"}}>
      <div style={{fontSize:10,color:"#6a8aaa",textTransform:"uppercase",letterSpacing:1,marginBottom:3}}>{label}</div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:13,color,fontWeight:700}}>{value}</div>
      {sub&&<div style={{fontSize:10,color:"#4a6a8a",marginTop:2}}>{sub}</div>}
    </div>
  );
}

function Section({title,children}){
  return(
    <div style={{marginTop:14}}>
      <div style={{fontSize:10,letterSpacing:2,color:"#6a8aaa",textTransform:"uppercase",fontFamily:"'IBM Plex Mono',monospace",marginBottom:8,display:"flex",alignItems:"center",gap:8,fontWeight:700}}>
        <span>{title}</span><div style={{flex:1,height:1,background:"#131c2e"}}/>
      </div>
      {children}
    </div>
  );
}

function FactorRow({label,score,good}){
  const c=good?"#4ade80":"#f87171";
  return(
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 0",borderBottom:"1px solid #0d1520"}}>
      <span style={{fontSize:11,color:"#8ab0d0"}}>{label}</span>
      <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:11,color:c,fontWeight:700,minWidth:30,textAlign:"right"}}>{score>=0?"+":""}{score}</span>
    </div>
  );
}

function Row({op,onClick,selected}){
  const sc=SC[op.signal];
  const pos=op.change24h>=0;
  const rsiC=op.rsi<40?"#00ff88":op.rsi>65?"#ef4444":"#94a3b8";
  const badges=[];
  if(op.macd?.crossover||op.macd?.recentCross) badges.push({t:"MACD√ó",c:"#00ff88"});
  if(op.div?.bullishDiv) badges.push({t:"DIV",c:"#a78bfa"});
  if(op.candle?.strength>=3) badges.push({t:op.candle.pattern.split(" ")[0].toUpperCase(),c:"#38bdf8"});
  if(op.sr?.nearSupport) badges.push({t:"SUPP",c:"#22c55e"});
  if(op.overextended) badges.push({t:"EXT‚ö†",c:"#ef4444"});
  if(op.sr?.nearResistance) badges.push({t:"RES‚ö†",c:"#ef4444"});

  return(
    <div onClick={()=>onClick(op)}
      style={{display:"grid",gridTemplateColumns:"80px 78px 62px 46px 52px 1fr 58px 44px",alignItems:"center",
        padding:"8px 14px",borderBottom:"1px solid #0d1520",gap:0,
        background:selected?SC[op.signal].bg+"cc":"transparent",
        borderLeft:`3px solid ${selected?sc.border:"transparent"}`,cursor:"pointer",transition:"background 0.12s"}}
      onMouseEnter={e=>{if(!selected)e.currentTarget.style.background="#0d1526";}}
      onMouseLeave={e=>{if(!selected)e.currentTarget.style.background="transparent";}}
    >
      <div style={{display:"flex",alignItems:"center",gap:5}}>
        <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:13,fontWeight:700,color:"#ffffff"}}>{op.symbol}</span>
        {op.dataSource==="live"&&<span style={{width:5,height:5,borderRadius:"50%",background:"#00ff88",animation:"pulse 2s infinite"}}/>}
      </div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:"#e2e8f0",textAlign:"right",paddingRight:8}}>{fmtPrice(op.price,op.symbol)}</div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:pos?"#4ade80":"#f87171",textAlign:"right",paddingRight:8,fontWeight:600}}>{pct(op.change24h)}</div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:rsiC,textAlign:"right",paddingRight:8,fontWeight:600}}>{op.rsi.toFixed(0)}</div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:11,color:op.volSpike>2?"#00ff88":"#7dd3fc",textAlign:"right",paddingRight:8}}>√ó{op.volSpike.toFixed(1)}</div>
      <div style={{display:"flex",gap:3,flexWrap:"wrap",overflow:"hidden",maxHeight:20}}>
        {badges.slice(0,3).map(b=>(
          <span key={b.t} style={{background:b.c+"20",border:`1px solid ${b.c}50`,color:b.c,fontSize:9,padding:"0 5px",borderRadius:3,fontFamily:"'IBM Plex Mono',monospace",lineHeight:"18px",fontWeight:700}}>{b.t}</span>
        ))}
      </div>
      <div style={{display:"flex",justifyContent:"center"}}>
        <span style={{background:sc.bg,border:`1px solid ${sc.border}`,color:sc.text,fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,letterSpacing:1,fontFamily:"'IBM Plex Mono',monospace",whiteSpace:"nowrap",boxShadow:selected?`0 0 10px ${sc.glow}`:undefined}}>
          {op.signal}
        </span>
      </div>
      <div style={{textAlign:"right"}}>
        <ScoreRing score={op.score}/>
      </div>
    </div>
  );
}

function TableHeader({sortBy,setSortBy}){
  const cols=[
    ["symbol","COIN","left"],["price","PRICE","right"],["change24h","24H%","right"],
    ["rsi","RSI","right"],["volSpike","VOL√ó","right"],["signals","SIGNALS","left"],
    ["signal","TIER","center"],["score","SCORE","right"],
  ];
  const sortable=["price","change24h","rsi","volSpike","score"];
  return(
    <div style={{display:"grid",gridTemplateColumns:"80px 78px 62px 46px 52px 1fr 58px 44px",padding:"7px 14px",borderBottom:"1px solid #131c2e",background:"#060a12",position:"sticky",top:0,zIndex:5}}>
      {cols.map(([key,label,align])=>(
        <div key={key} onClick={()=>sortable.includes(key)&&setSortBy(key)}
          style={{fontSize:10,letterSpacing:1.5,color:sortBy===key?"#38bdf8":"#6a8aaa",textTransform:"uppercase",fontFamily:"'IBM Plex Mono',monospace",textAlign:align,cursor:sortable.includes(key)?"pointer":"default",paddingRight:align==="right"?8:0,userSelect:"none",fontWeight:sortBy===key?700:400}}>
          {label}{sortBy===key?" ‚ñº":""}
        </div>
      ))}
    </div>
  );
}

function TradingViewChart({symbol}){
  const ref=useRef(null);
  useEffect(()=>{
    if(!ref.current||!symbol) return;
    ref.current.innerHTML="";
    const s=document.createElement("script");
    s.src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js";
    s.async=true;
    s.innerHTML=JSON.stringify({
      autosize:true,symbol:`BINANCE:${symbol}USDT`,interval:"240",
      timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",
      backgroundColor:"#050810",gridColor:"#0d1220",
      hide_top_toolbar:false,save_image:false,
      studies:["RSI@tv-basicstudies","MACD@tv-basicstudies","BB@tv-basicstudies"],
      support_host:"https://www.tradingview.com"
    });
    ref.current.appendChild(s);
  },[symbol]);
  return(
    <div style={{width:"100%",height:310,borderRadius:8,overflow:"hidden",border:"1px solid #0d1220"}}>
      <div ref={ref} style={{width:"100%",height:"100%"}}><div style={{width:"100%",height:"100%"}}/></div>
    </div>
  );
}


function DetailPanel({op,onAlert}){
  if(!op) return(
    <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:10,padding:20}}>
      <div style={{fontSize:40,opacity:0.12}}>‚óà</div>
      <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:"#6a8aaa",textAlign:"center",lineHeight:1.8}}>
        Select a coin to view<br/>full signal analysis
      </div>
    </div>
  );
  const sc=SC[op.signal];
  const pos=op.change24h>=0;
  const factors=op.factors||{};
  const factorList=Object.entries(factors);
  const totalRaw=factorList.reduce((s,[,f])=>s+f.score,0);

  return(
    <div style={{padding:"14px 16px",overflowY:"auto",height:"100%",animation:"fadeIn 0.2s ease"}}>
      {/* Header */}
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12}}>
        <div>
          <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:18,fontWeight:700,color:"#ffffff",display:"flex",alignItems:"center",gap:8}}>
            {op.symbol}/USDT
            {op.dataSource==="live"&&<span style={{fontSize:9,background:"#071a0f",border:"1px solid #00ff8840",color:"#00ff88",padding:"2px 6px",borderRadius:3}}>LIVE</span>}
          </div>
          <div style={{fontSize:11,color:"#8ab0d0",marginTop:3}}>Swing Trade Signal Analysis ¬∑ 4H</div>
        </div>
        <div style={{textAlign:"right"}}>
          <div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:18,color:"#ffffff",fontWeight:700}}>{fmtPrice(op.price,op.symbol)}</div>
          <div style={{fontSize:11,color:pos?"#4ade80":"#f87171",fontFamily:"'IBM Plex Mono',monospace",fontWeight:600}}>{pct(op.change24h)} 24h ¬∑ {pct(op.change7d||0)} 7d</div>
        </div>
      </div>

      {/* Signal box */}
      <div style={{background:sc.bg,border:`1px solid ${sc.border}`,borderRadius:8,padding:"10px 14px",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:`0 0 20px ${sc.glow}`,marginBottom:4}}>
        <div>
          <div style={{color:sc.text,fontFamily:"'IBM Plex Mono',monospace",fontSize:16,fontWeight:700}}>{op.signal}</div>
          <div style={{fontSize:9,color:sc.text+"99",marginTop:1}}>{op.score>=80?"High probability setup":op.score>=63?"Good setup ‚Äî confirm on chart":op.score>=45?"Wait for confirmation":"Low probability ‚Äî pass"}</div>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:10}}>
          <ScoreRing score={op.score}/>
          <button onClick={()=>onAlert(op)} style={{background:"#000000aa",border:`1px solid ${sc.border}50`,color:sc.text,padding:"5px 10px",borderRadius:4,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:9,letterSpacing:1}}>üîî ALERT</button>
        </div>
      </div>

      {/* Warning banners */}
      {op.overextended&&<div style={{background:"#1c0808",border:"1px solid #ef444440",borderRadius:6,padding:"7px 10px",marginBottom:4,fontSize:10,color:"#ef4444"}}>‚ö† OVEREXTENDED ‚Äî Price is &gt;8% above EMA20. Risky entry. Wait for pullback.</div>}
      {op.sr?.nearResistance&&<div style={{background:"#1c0808",border:"1px solid #ef444440",borderRadius:6,padding:"7px 10px",marginBottom:4,fontSize:10,color:"#ef4444"}}>‚ö† NEAR RESISTANCE ‚Äî You may be buying the top. Wait for breakout confirmation.</div>}
      {op.div?.bullishDiv&&<div style={{background:"#04160b",border:"1px solid #00ff8840",borderRadius:6,padding:"7px 10px",marginBottom:4,fontSize:10,color:"#00ff88"}}>‚ú¶ BULLISH DIVERGENCE ‚Äî RSI rising while price dipping. Early signal before the move.</div>}
      {(op.macd?.crossover||op.macd?.recentCross)&&<div style={{background:"#04160b",border:"1px solid #22c55e40",borderRadius:6,padding:"7px 10px",marginBottom:4,fontSize:10,color:"#22c55e"}}>‚ú¶ MACD CROSSOVER ‚Äî Momentum just turned bullish. Early entry signal.</div>}

      {/* Chart */}
      <div style={{marginTop:10,marginBottom:10}}>
        <TradingViewChart symbol={op.symbol}/>
      </div>

      {/* Trade levels */}
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:10}}>
        <StatBox label="Entry" value={fmtPrice(op.price,op.symbol)} color="#38bdf8"/>
        <StatBox label="Target" value={fmtPrice(op.target,op.symbol)} color="#00ff88" sub={`+${(((op.target-op.price)/op.price)*100).toFixed(1)}%`}/>
        <StatBox label="Stop" value={fmtPrice(op.stopLoss,op.symbol)} color="#ef4444" sub={`-${(((op.price-op.stopLoss)/op.price)*100).toFixed(1)}%`}/>
        <StatBox label="R/R" value={`${op.rrRatio}:1`} color="#eab308" sub={op.rrRatio>=2?"Good ratio":"Low ratio"}/>
      </div>

      {/* Technical grid */}
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:10}}>
        <StatBox label="RSI (14)" value={op.rsi.toFixed(1)} color={op.rsi<40?"#00ff88":op.rsi>65?"#ef4444":"#94a3b8"} sub={op.rsi<40?"Oversold":op.rsi>65?"Overbought":"Neutral"}/>
        <StatBox label="MACD" value={op.macd?.bullish?"Bullish":"Bearish"} color={op.macd?.bullish?"#22c55e":"#ef4444"} sub={op.macd?.crossover?"Fresh crossover!":op.macd?.recentCross?"Recent cross":""}/>
        <StatBox label="BB Position" value={`${(op.bb?.pct*100||50).toFixed(0)}%`} color={op.bb?.pct<0.25?"#00ff88":op.bb?.pct>0.8?"#ef4444":"#94a3b8"} sub={op.bb?.pct<0.25?"Near lower band":op.bb?.pct>0.75?"Near upper band":"Mid range"}/>
        <StatBox label="Vol Spike" value={`√ó${op.volSpike.toFixed(2)}`} color={op.volSpike>2?"#00ff88":"#38bdf8"} sub={fmtVol(op.volume)}/>
        <StatBox label="EMA Trend" value={op.emaTrendBull?"Bullish":"Bearish"} color={op.emaTrendBull?"#22c55e":"#ef4444"} sub="EMA20 vs EMA50"/>
        <StatBox label="Candle" value={op.candle?.pattern||"‚Äî"} color={op.candle?.bullish?"#22c55e":"#ef4444"}/>
      </div>

      {/* S/R */}
      <div style={{background:"#0a0d10",border:"1px solid #111820",borderRadius:7,padding:"10px 12px",marginBottom:10}}>
        <div style={{fontSize:9,color:"#1e3050",textTransform:"uppercase",letterSpacing:2,marginBottom:8}}>Support &amp; Resistance</div>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
          <span style={{fontSize:10,color:"#22c55e"}}>Support: {fmtPrice(op.support,op.symbol)}</span>
          <span style={{fontSize:10,color:"#ef4444"}}>Resistance: {fmtPrice(op.resistance,op.symbol)}</span>
        </div>
        {/* Range bar */}
        <div style={{height:6,background:"#111820",borderRadius:3,position:"relative"}}>
          <div style={{position:"absolute",left:0,right:0,top:0,height:6,borderRadius:3,background:"linear-gradient(to right, #22c55e22, #ef444422)"}}>
            <div style={{position:"absolute",left:`${(op.sr?.pct||0.5)*100}%`,transform:"translateX(-50%)",top:-2,width:10,height:10,borderRadius:"50%",background:"#38bdf8",border:"2px solid #050810"}}/>
          </div>
        </div>
        <div style={{display:"flex",justifyContent:"space-between",marginTop:4,fontSize:9,color:"#1e3050"}}>
          <span>SUPPORT</span>
          <span style={{color:"#38bdf8"}}>PRICE {((op.sr?.pct||0.5)*100).toFixed(0)}% of range</span>
          <span>RESISTANCE</span>
        </div>
      </div>

      {/* Score breakdown */}
      <div style={{background:"#0b1018",border:"1px solid #1a2535",borderRadius:7,padding:"10px 12px",marginBottom:10}}>
        <div style={{fontSize:10,color:"#8ab0d0",textTransform:"uppercase",letterSpacing:2,marginBottom:8,fontWeight:700}}>Signal Score Breakdown</div>
        {factorList.map(([key,f])=><FactorRow key={key} label={f.label} score={f.score} good={f.good}/>)}
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8,paddingTop:6,borderTop:"1px solid #131c2e"}}>
          <span style={{fontSize:11,color:"#8ab0d0",fontWeight:600}}>Composite Score</span>
          <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:14,color:op.score>=80?"#00ff88":op.score>=63?"#22c55e":op.score>=45?"#eab308":"#ef4444",fontWeight:700}}>{op.score}/100</span>
        </div>
      </div>

      {/* Checklist */}
      <div style={{background:"#0b1018",border:"1px solid #1a2535",borderRadius:7,padding:"10px 12px",marginBottom:14}}>
        <div style={{fontSize:10,color:"#8ab0d0",textTransform:"uppercase",letterSpacing:2,marginBottom:8,fontWeight:700}}>Entry Checklist</div>
        {[
          [!op.overextended, "Price not overextended (within 8% of EMA20)"],
          [!op.sr?.nearResistance, "Not near key resistance"],
          [op.sr?.nearSupport||op.bb?.pct<0.3, "Near support or lower Bollinger Band"],
          [op.rsi<60, "RSI below 60 (not overbought)"],
          [op.macd?.bullish, "MACD momentum bullish"],
          [op.volume>=5e7, "Volume ‚â• $50M (sufficient liquidity)"],
          [op.candle?.bullish, "Bullish candle pattern confirmed"],
          [op.rrRatio>=1.5, "R/R ratio ‚â• 1.5"],
        ].map(([pass,label],i)=>(
          <div key={i} style={{display:"flex",alignItems:"center",gap:7,marginBottom:5}}>
            <span style={{fontSize:13,color:pass?"#4ade80":"#f87171",fontWeight:700}}>{pass?"‚úì":"‚úó"}</span>
            <span style={{fontSize:11,color:pass?"#94b8c8":"#5a6a7a"}}>{label}</span>
          </div>
        ))}
      </div>
      <div style={{height:8}}/>
    </div>
  );
}

function AlertModal({op,onClose}){
  const [webhook,setWebhook]=useState("");
  const [tgToken,setTgToken]=useState("");
  const [tgChat,setTgChat]=useState("");
  const [tab,setTab]=useState("discord");
  const [status,setStatus]=useState(null);
  const warnings=[];
  if(op?.overextended) warnings.push("‚ö† OVEREXTENDED");
  if(op?.sr?.nearResistance) warnings.push("‚ö† NEAR RESISTANCE");
  const bullish=[];
  if(op?.div?.bullishDiv) bullish.push("‚ú¶ Bullish RSI Divergence");
  if(op?.macd?.crossover) bullish.push("‚ú¶ MACD Crossover");
  if(op?.sr?.nearSupport) bullish.push("‚ú¶ Near Support");
  const msg=op?`üö® SWING SCANNER PRO ‚Äî ${op.signal}\n\n${op.symbol}/USDT ¬∑ Score: ${op.score}/100\nPrice: ${fmtPrice(op.price,op.symbol)}\n24h: ${pct(op.change24h)} ¬∑ 7d: ${pct(op.change7d||0)}\nRSI: ${op.rsi.toFixed(1)} ¬∑ MACD: ${op.macd?.bullish?"Bull":"Bear"} ¬∑ Vol: √ó${op.volSpike.toFixed(1)}\nCandle: ${op.candle?.pattern}\nEntry: ${fmtPrice(op.price,op.symbol)} ¬∑ Target: ${fmtPrice(op.target,op.symbol)} ¬∑ Stop: ${fmtPrice(op.stopLoss,op.symbol)}\nR/R: ${op.rrRatio}:1\n${bullish.length?"\n"+bullish.join("\n"):""}${warnings.length?"\n"+warnings.join("\n"):""}`:
  "";
  async function sendDiscord(){if(!webhook){setStatus({err:"Enter webhook"});return;}setStatus({loading:true});try{const r=await fetch(webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:msg,username:"SwingScanner Pro"})});setStatus(r.ok?{ok:"Sent ‚úì"}:{err:r.statusText});}catch(e){setStatus({err:"CORS ‚Äî test from Discord"});}}
  async function sendTelegram(){if(!tgToken||!tgChat){setStatus({err:"Enter token & ID"});return;}setStatus({loading:true});try{const r=await fetch(`https://api.telegram.org/bot${tgToken}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:tgChat,text:msg})});const d=await r.json();setStatus(d.ok?{ok:"Sent ‚úì"}:{err:d.description});}catch(e){setStatus({err:e.message});}}
  return(
    <div style={{position:"fixed",inset:0,background:"#000000dd",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)"}}>
      <div style={{background:"#080b0e",border:"1px solid #1a2535",borderRadius:14,width:460,maxWidth:"95vw",padding:22}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:14}}>
          <span style={{fontFamily:"'IBM Plex Mono',monospace",color:"#dde4f0",fontSize:13,fontWeight:700}}>üîî Alert ‚Äî {op?.symbol}</span>
          <button onClick={onClose} style={{background:"none",border:"none",color:"#3d5070",cursor:"pointer",fontSize:16}}>‚úï</button>
        </div>
        <div style={{background:"#040608",border:"1px solid #111820",borderRadius:7,padding:"9px 11px",marginBottom:12,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,color:"#4a7090",whiteSpace:"pre-line",lineHeight:1.6,maxHeight:130,overflowY:"auto"}}>{msg}</div>
        <div style={{display:"flex",gap:5,marginBottom:12}}>
          {["discord","telegram","copy"].map(t=><button key={t} onClick={()=>{setTab(t);setStatus(null);}} style={{background:tab===t?"#0d1a28":"transparent",border:`1px solid ${tab===t?"#38bdf8":"#1a2535"}`,color:tab===t?"#38bdf8":"#3d5070",padding:"4px 11px",borderRadius:4,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:9,textTransform:"uppercase"}}>{t}</button>)}
        </div>
        {tab==="discord"&&<><input value={webhook} onChange={e=>setWebhook(e.target.value)} placeholder="https://discord.com/api/webhooks/‚Ä¶" style={{width:"100%",background:"#040608",border:"1px solid #1a2535",color:"#8ab0d0",padding:"7px 9px",borderRadius:5,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none",marginBottom:8}}/><button onClick={sendDiscord} style={{background:"#071428",border:"1px solid #38bdf8",color:"#38bdf8",padding:"7px 14px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,fontWeight:700}}>SEND</button></>}
        {tab==="telegram"&&<><input value={tgToken} onChange={e=>setTgToken(e.target.value)} placeholder="Bot token" style={{width:"100%",background:"#040608",border:"1px solid #1a2535",color:"#8ab0d0",padding:"7px 9px",borderRadius:5,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none",marginBottom:6}}/><input value={tgChat} onChange={e=>setTgChat(e.target.value)} placeholder="Chat ID" style={{width:"100%",background:"#040608",border:"1px solid #1a2535",color:"#8ab0d0",padding:"7px 9px",borderRadius:5,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none",marginBottom:8}}/><button onClick={sendTelegram} style={{background:"#071428",border:"1px solid #38bdf8",color:"#38bdf8",padding:"7px 14px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,fontWeight:700}}>SEND</button></>}
        {tab==="copy"&&<button onClick={()=>{navigator.clipboard.writeText(msg);setStatus({ok:"Copied ‚úì"});}} style={{background:"#071428",border:"1px solid #7c6ef0",color:"#7c6ef0",padding:"7px 14px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,fontWeight:700}}>COPY</button>}
        {status&&<div style={{marginTop:9,padding:"6px 9px",borderRadius:5,background:status.ok?"#0d2218":"#1c0a0a",color:status.ok?"#22c55e":"#ef4444",fontFamily:"'IBM Plex Mono',monospace",fontSize:10}}>{status.loading?"Sending‚Ä¶":status.ok||status.err}</div>}
      </div>
    </div>
  );
}

function SettingsModal({config,onSave,onClose}){
  const [autoRefresh,setAutoRefresh]=useState(config.autoRefresh||false);
  const [ivl,setIvl]=useState(config.interval||300);
  return(
    <div style={{position:"fixed",inset:0,background:"#000000dd",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)"}}>
      <div style={{background:"#080b0e",border:"1px solid #1a2535",borderRadius:14,width:380,maxWidth:"95vw",padding:22}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:18}}>
          <span style={{fontFamily:"'IBM Plex Mono',monospace",color:"#dde4f0",fontSize:13,fontWeight:700}}>‚öô Settings</span>
          <button onClick={onClose} style={{background:"none",border:"none",color:"#3d5070",cursor:"pointer",fontSize:16}}>‚úï</button>
        </div>
        <div style={{padding:"10px 12px",background:"#040810",border:"1px solid #111820",borderRadius:7,fontSize:10,color:"#2d4060",lineHeight:2,marginBottom:16}}>
          <div><span style={{color:"#00ff88"}}>‚óè</span> Binance API ¬∑ 4H klines ¬∑ free ¬∑ no key</div>
          <div><span style={{color:"#eab308"}}>‚óè</span> SIM fallback if Binance unreachable</div>
          <div><span style={{color:"#38bdf8"}}>‚óè</span> Min volume: $50M USDT (enforced)</div>
        </div>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16}}>
          <div><div style={{fontSize:11,color:"#4a6080"}}>Auto-refresh</div><div style={{fontSize:9,color:"#243040"}}>Re-scan on interval</div></div>
          <div onClick={()=>setAutoRefresh(v=>!v)} style={{width:42,height:22,borderRadius:11,background:autoRefresh?"#0d2b1a":"#111820",border:`1px solid ${autoRefresh?"#00ff88":"#1a2535"}`,cursor:"pointer",position:"relative",transition:"all 0.2s"}}>
            <div style={{width:16,height:16,borderRadius:"50%",background:autoRefresh?"#00ff88":"#334155",position:"absolute",top:2,left:autoRefresh?22:2,transition:"left 0.2s"}}/>
          </div>
        </div>
        {autoRefresh&&<div style={{marginBottom:16}}>
          <label style={{fontSize:10,color:"#3d5070",display:"block",marginBottom:4}}>Interval</label>
          <select value={ivl} onChange={e=>setIvl(Number(e.target.value))} style={{background:"#040608",border:"1px solid #1a2535",color:"#8ab0d0",padding:"6px 10px",borderRadius:5,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none"}}>
            {[60,120,300,600,1800].map(v=><option key={v} value={v}>{v<120?"1 min":v<300?"2 min":v<600?"5 min":v<1800?"10 min":"30 min"}</option>)}
          </select>
        </div>}
        <div style={{display:"flex",gap:8}}>
          <button onClick={()=>onSave({autoRefresh,interval:ivl})} style={{background:"#071428",border:"1px solid #00ff88",color:"#00ff88",padding:"7px 16px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,fontWeight:700}}>SAVE</button>
          <button onClick={onClose} style={{background:"none",border:"1px solid #1a2535",color:"#3d5070",padding:"7px 16px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10}}>CANCEL</button>
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App(){
  const [ops,setOps]=useState([]);
  const [selected,setSelected]=useState(null);
  const [filter,setFilter]=useState("ALL");
  const [sortBy,setSortBy]=useState("score");
  const [scanning,setScanning]=useState(false);
  const [progress,setProgress]=useState(0);
  const [lastScan,setLastScan]=useState(null);
  const [alertOp,setAlertOp]=useState(null);
  const [showSettings,setShowSettings]=useState(false);
  const [config,setConfig]=useState({autoRefresh:false,interval:300});
  const [errors,setErrors]=useState([]);
  const [search,setSearch]=useState("");
  const [minScore,setMinScore]=useState(0);
  const [dataMode,setDataMode]=useState("sim");
  const [minVol,setMinVol]=useState(50); // $M
  const [hideWarnings,setHideWarnings]=useState(false);
  const autoTimer=useRef(null);

  const scan=useCallback(async()=>{
    setScanning(true);setProgress(0);setSelected(null);
    const errs=[];let liveOk=false;let result=[];
    try{
      const tickRes=await fetch(`${BASE}/ticker/24hr`);
      if(!tickRes.ok) throw new Error(tickRes.status);
      const tickers=await tickRes.json();
      setProgress(25);

      const stables=new Set(["USDT","BUSD","USDC","TUSD","DAI","FDUSD","USDP","USDD","EUR","GBP"]);
      const pairs=tickers
        .filter(t=>t.symbol.endsWith("USDT")&&!stables.has(t.symbol.replace("USDT",""))&&parseFloat(t.quoteVolume)>=5e7) // Hard $50M filter
        .sort((a,b)=>parseFloat(b.quoteVolume)-parseFloat(a.quoteVolume))
        .slice(0,200);
      setProgress(35);

      // Fetch 4H klines in batches
      const BATCH=8;const kMap={};
      for(let i=0;i<pairs.length;i+=BATCH){
        const batch=pairs.slice(i,i+BATCH);
        await Promise.all(batch.map(async t=>{
          try{
            const r=await fetch(`${BASE}/klines?symbol=${t.symbol}&interval=4h&limit=100`);
            if(r.ok){const d=await r.json();kMap[t.symbol]=d;}
          }catch(e){}
        }));
        setProgress(35+Math.round(((i+BATCH)/pairs.length)*55));
      }

      result=pairs.map(ticker=>{
        const sym=ticker.symbol.replace("USDT","");
        const price=parseFloat(ticker.lastPrice);
        const change24h=parseFloat(ticker.priceChangePercent);
        const volume=parseFloat(ticker.quoteVolume);
        const klines=kMap[ticker.symbol]||[];
        if(klines.length<20) return null;
        const opens=klines.map(k=>parseFloat(k[1]));
        const highs=klines.map(k=>parseFloat(k[2]));
        const lows=klines.map(k=>parseFloat(k[3]));
        const closes=klines.map(k=>parseFloat(k[4]));
        const vols=klines.map(k=>parseFloat(k[5]));
        // Avg volume = last 20 bars excluding current
        const avgVolume=vols.slice(-21,-1).reduce((a,b)=>a+b,0)/20;
        const currVolume=vols[vols.length-1];
        const change7d=closes.length>=42?((closes[closes.length-1]-closes[closes.length-42])/closes[closes.length-42])*100:change24h;
        const analysis=scoreOpportunity({closes,highs,lows,opens,volume:currVolume,avgVolume});
        return{id:sym,symbol:sym,name:sym,price,change24h,change7d,volume,closes,opens,highs,lows,...analysis,dataSource:"live"};
      }).filter(Boolean);

      liveOk=true;
    }catch(e){
      errs.push(`Binance: ${e.message}`);
      result=SIM_COINS.map(makeSim);
    }
    setProgress(100);setOps(result);setLastScan(new Date());setErrors(errs);setDataMode(liveOk?"live":"sim");setScanning(false);
  },[]);

  useEffect(()=>{scan();},[]);
  useEffect(()=>{
    if(autoTimer.current) clearInterval(autoTimer.current);
    if(config.autoRefresh) autoTimer.current=setInterval(scan,config.interval*1000);
    return()=>{if(autoTimer.current) clearInterval(autoTimer.current);};
  },[config,scan]);

  const TIERS=["ALL","PRIME","STRONG","WATCH","AVOID"];
  const filtered=useMemo(()=>ops
    .filter(o=>filter==="ALL"||o.signal===filter)
    .filter(o=>o.score>=minScore)
    .filter(o=>o.volume>=(minVol*1e6))
    .filter(o=>!hideWarnings||(o.signal!=="AVOID"&&!o.overextended&&!o.sr?.nearResistance))
    .filter(o=>!search||o.symbol.toLowerCase().includes(search.toLowerCase()))
    .sort((a,b)=>{
      if(sortBy==="score") return b.score-a.score;
      if(sortBy==="rsi") return a.rsi-b.rsi;
      if(sortBy==="volSpike") return b.volSpike-a.volSpike;
      if(sortBy==="change24h") return b.change24h-a.change24h;
      if(sortBy==="price") return b.price-a.price;
      return b.score-a.score;
    })
  ,[ops,filter,minScore,minVol,hideWarnings,search,sortBy]);

  const primes=ops.filter(o=>o.signal==="PRIME").length;
  const strongs=ops.filter(o=>o.signal==="STRONG").length;
  const divs=ops.filter(o=>o.div?.bullishDiv).length;
  const crossovers=ops.filter(o=>o.macd?.crossover||o.macd?.recentCross).length;

  return(
    <div style={{height:"100vh",background:"#040608",fontFamily:"'DM Sans',sans-serif",color:"#c8d4e8",display:"flex",flexDirection:"column",overflow:"hidden"}}>

      {/* HEADER */}
      <div style={{borderBottom:"1px solid #131c2e",padding:"10px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#060a12",flexShrink:0}}>
        <div style={{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"}}>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <div style={{width:8,height:8,borderRadius:"50%",background:"#00ff88",boxShadow:"0 0 10px #00ff88",animation:"pulse 2s infinite"}}/>
            <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:14,fontWeight:700,letterSpacing:2,color:"#ffffff"}}>SWING SCANNER PRO</span>
            <span style={{fontSize:10,background:"#0e1828",border:"1px solid #1e3040",color:"#6a8aaa",padding:"2px 7px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace"}}>4H ¬∑ BINANCE ¬∑ $50M+</span>
            {dataMode==="live"
              ?<span style={{fontSize:10,background:"#071a0f",border:"1px solid #00ff8870",color:"#00ff88",padding:"2px 8px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace",fontWeight:700}}>‚óè LIVE</span>
              :<span style={{fontSize:10,background:"#161200",border:"1px solid #eab30870",color:"#eab308",padding:"2px 8px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace",fontWeight:700}}>‚óè SIM</span>}
          </div>
          <div style={{height:16,width:1,background:"#1a2535"}}/>
          <span style={{fontSize:11,color:"#00ff88",fontFamily:"'IBM Plex Mono',monospace",fontWeight:700}}>{primes} PRIME</span>
          <span style={{fontSize:11,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace",fontWeight:700}}>{strongs} STRONG</span>
          <span style={{fontSize:11,color:"#a78bfa",fontFamily:"'IBM Plex Mono',monospace"}}>{divs} DIV</span>
          <span style={{fontSize:11,color:"#38bdf8",fontFamily:"'IBM Plex Mono',monospace"}}>{crossovers} MACD√ó</span>
          <span style={{fontSize:11,color:"#4a6080",fontFamily:"'IBM Plex Mono',monospace"}}>{ops.length} coins</span>
          {errors.length>0&&<span style={{fontSize:10,color:"#f87171",background:"#1c0808",border:"1px solid #3a1010",padding:"2px 8px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace"}}>‚ö† {errors[0]}</span>}
        </div>
        <div style={{display:"flex",alignItems:"center",gap:8}}>
          {lastScan&&<span style={{fontSize:10,color:"#4a6080",fontFamily:"'IBM Plex Mono',monospace"}}>{lastScan.toLocaleTimeString()}</span>}
          {config.autoRefresh&&<span style={{fontSize:10,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace"}}>AUTO ‚úì</span>}
          <button onClick={()=>setShowSettings(true)} style={{background:"#0e1828",border:"1px solid #1e3040",color:"#8ab0d0",padding:"6px 12px",borderRadius:5,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:11}}>‚öô CONFIG</button>
          <button onClick={scan} disabled={scanning} style={{background:scanning?"#040810":"#071f0e",border:`1px solid ${scanning?"#1a2535":"#00ff88"}`,color:scanning?"#3a5040":"#00ff88",padding:"6px 16px",borderRadius:5,cursor:scanning?"not-allowed":"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:11,fontWeight:700,letterSpacing:1}}>
            {scanning?`‚ü≥ ${progress}%`:"‚ü≥ SCAN"}
          </button>
        </div>
      </div>

      {scanning&&<div style={{height:2,background:"#080d14",flexShrink:0}}><div style={{height:2,background:"#00ff88",width:`${progress}%`,transition:"width 0.3s ease",boxShadow:"0 0 8px #00ff88"}}/></div>}

      {/* FILTER BAR */}
      <div style={{padding:"7px 14px",borderBottom:"1px solid #0d1520",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,gap:8,flexWrap:"wrap",background:"#050810"}}>
        {/* Signal tier tabs */}
        <div style={{display:"flex",gap:4}}>
          {TIERS.map(t=>{
            const s=t!=="ALL"?SC[t]:null;
            return<button key={t} onClick={()=>setFilter(t)} style={{background:filter===t?(s?s.bg:"#0e1828"):"transparent",border:`1px solid ${filter===t?(s?s.border:"#38bdf8"):"#1a2535"}`,color:filter===t?(s?s.text:"#38bdf8"):"#6a8aaa",padding:"4px 11px",borderRadius:4,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,letterSpacing:1,fontWeight:filter===t?700:400}}>{t}</button>;
          })}
        </div>
        <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
          {/* Search */}
          <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="‚åï Search coin‚Ä¶" style={{background:"#0a0f1a",border:"1px solid #1a2535",color:"#c8d4e8",padding:"5px 9px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none",width:110}}/>
          {/* Min Score */}
          <select value={minScore} onChange={e=>setMinScore(Number(e.target.value))} style={{background:"#0a0f1a",border:"1px solid #1a2535",color:"#c8d4e8",padding:"5px 7px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none"}}>
            {[0,40,50,60,70,80].map(v=><option key={v} value={v}>{v===0?"Score: All":"Score ‚â•"+v}</option>)}
          </select>
          {/* Min Volume */}
          <select value={minVol} onChange={e=>setMinVol(Number(e.target.value))} style={{background:"#0a0f1a",border:"1px solid #1a2535",color:"#c8d4e8",padding:"5px 7px",borderRadius:4,fontFamily:"'IBM Plex Mono',monospace",fontSize:10,outline:"none"}}>
            {[50,100,200,500].map(v=><option key={v} value={v}>Vol ‚â•${v}M</option>)}
          </select>
          {/* Safe mode toggle */}
          <button onClick={()=>setHideWarnings(v=>!v)} style={{background:hideWarnings?"#1a1000":"#0a0f1a",border:`1px solid ${hideWarnings?"#eab308":"#1a2535"}`,color:hideWarnings?"#eab308":"#6a8aaa",padding:"4px 10px",borderRadius:4,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:10,fontWeight:hideWarnings?700:400}}>
            {hideWarnings?"SAFE MODE ‚úì":"SAFE MODE"}
          </button>
          <span style={{fontSize:10,color:"#4a6080",fontFamily:"'IBM Plex Mono',monospace"}}>{filtered.length} results</span>
        </div>
      </div>

      {/* MAIN */}
      <div style={{display:"flex",flex:1,overflow:"hidden"}}>
        <div style={{flex:1,overflowY:"auto",overflowX:"hidden"}}>
          {scanning&&ops.length===0?(
            <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:10}}>
              <div style={{fontFamily:"'IBM Plex Mono',monospace",color:"#00ff88",fontSize:13,letterSpacing:4,animation:"blink 1s ease-in-out infinite"}}>SCANNING BINANCE</div>
              <div style={{color:"#6a8aaa",fontSize:11,letterSpacing:2}}>{progress<35?"Fetching tickers (‚â•$50M filter)‚Ä¶":progress<90?"Analysing 4H klines‚Ä¶":"Scoring signals‚Ä¶"} {progress}%</div>
            </div>
          ):(
            <>
              <TableHeader sortBy={sortBy} setSortBy={setSortBy}/>
              {filtered.length===0&&<div style={{color:"#6a8aaa",fontSize:13,textAlign:"center",marginTop:60,fontFamily:"'IBM Plex Mono',monospace"}}>No coins match current filters</div>}
              {filtered.map(op=><Row key={op.id} op={op} onClick={setSelected} selected={selected?.id===op.id}/>)}
            </>
          )}
        </div>
        {selected&&(
          <div style={{width:440,borderLeft:"1px solid #131c2e",overflowY:"auto",background:"#060a12",flexShrink:0,display:"flex",flexDirection:"column"}}>
            {/* Sticky back bar */}
            <div style={{position:"sticky",top:0,zIndex:10,background:"#060a12",borderBottom:"1px solid #131c2e",padding:"10px 14px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
              <button
                onClick={()=>setSelected(null)}
                style={{display:"flex",alignItems:"center",gap:7,background:"#0e1828",border:"1px solid #1e3040",color:"#c8d4e8",padding:"7px 14px",borderRadius:6,cursor:"pointer",fontFamily:"'IBM Plex Mono',monospace",fontSize:11,fontWeight:700,letterSpacing:1,transition:"all 0.15s"}}
                onMouseEnter={e=>{e.currentTarget.style.background="#162030";e.currentTarget.style.borderColor="#38bdf8";e.currentTarget.style.color="#38bdf8";}}
                onMouseLeave={e=>{e.currentTarget.style.background="#0e1828";e.currentTarget.style.borderColor="#1e3040";e.currentTarget.style.color="#c8d4e8";}}
              >
                ‚Üê BACK TO LIST
              </button>
              <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:"#ffffff",fontWeight:700}}>{selected.symbol}/USDT</span>
            </div>
            <div style={{flex:1,overflowY:"auto"}}>
              <DetailPanel op={selected} onAlert={setAlertOp}/>
            </div>
          </div>
        )}
      </div>

      {alertOp&&<AlertModal op={alertOp} onClose={()=>setAlertOp(null)}/>}
      {showSettings&&<SettingsModal config={config} onSave={c=>{setConfig(c);setShowSettings(false);}} onClose={()=>setShowSettings(false)}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
